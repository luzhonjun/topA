## 问题概述
- 部署失败的直接原因：上传文件数超过免费额度（>5000）。
- 主要来源：`server/.venv`、`__pycache__`、可能的构建产物/缓存目录。

## 目标
- 将上传文件量控制在额度范围内。
- 使前后端可以在免费平台稳定访问。

## 仓库瘦身（必须执行）
1. 删除本地和仓库中的 `server/.venv` 目录（不要提交虚拟环境）。
2. 清理并排除：`**/__pycache__`、`*.pyc`、任何临时或缓存文件夹（如 `.pytest_cache`、`.cache`）。
3. 确保忽略文件生效：
   - `.gitignore`：包含 `server/.venv`、`.venv`、`**/__pycache__`、`*.pyc`、`node_modules`、`dist`。
   - 若平台支持上传忽略（例如 Vercel 的 `.vercelignore`）：同样加入上述条目。
4. 重新打包/上传时仅包含源代码和依赖清单（`server/requirements.txt`、前端源文件）。

## 部署方案 A：Render（推荐，前后端分离）
### 后端（Flask Web Service）
- 根目录：`server`
- Build：`pip install -r requirements.txt`
- Start：`python app.py`
- 环境变量：`TUSHARE_TOKEN=<你的token>`、`PYTHON_VERSION=3.11`（可选）
- 端口：平台注入 `PORT`（代码已从 `PORT` 读取并绑定 `0.0.0.0`）
- 得到地址：`https://<your-service>.onrender.com`

### 前端（Static Site）
- 根目录：项目根
- Build：`npm ci && npm run build`
- Publish：`dist`
- 环境变量：`VITE_API_BASE=https://<your-service>.onrender.com`
- 前端已读取 `VITE_API_BASE` 并走 `/api/...` 相对路径。

## 部署方案 B：Railway（一体化）
- 新建 Project，添加两个 Service：前端（Static/Node）和后端（Python）。
- 后端：同 Render 配置；前端：`npm ci && npm run build`，可用静态资源服务。
- 环境变量：`TUSHARE_TOKEN`、`VITE_API_BASE=https://<railway-backend-domain>`。

## 备选组合：Vercel + Render/Railway
- 前端在 Vercel，后端在 Render/Railway。
- 在 Vercel 设置 `VITE_API_BASE` 指向后端域名。

## Trae 部署注意事项（若继续使用 Trae）
- 在上传前执行“仓库瘦身”步骤，确保不会上传 `.venv`、`__pycache__` 等大量文件。
- 如 Trae 不支持忽略文件，可准备一个“轻量部署目录”（例如 `deploy/`），只拷贝必要源文件与配置，再从该目录发起部署。

## 环境变量与配置
- 后端：`TUSHARE_TOKEN` 必填，`PORT` 由平台管理；关闭 debug 已在代码处理。
- 前端：`VITE_API_BASE` 指向后端地址或通过反向代理同域访问。

## 验证清单
- 后端接口：访问 `GET /api/stocks/top/daily?limit=50&offset=-1` 返回昨日榜单。
- 指定日期：`GET /api/stocks/top/daily?date=YYYY-MM-DD&limit=50`。
- 前端页面：数据日期显示正确；导出文件名包含数据日期；“今日”无日线时提示为空。

## 若需要我执行
- 我可以：
  - 清理仓库中冗余目录（不触发上传超限）。
  - 创建 `deploy/` 轻量目录并复制必要文件。
  - 按选定平台添加最小化配置并指导你设置环境变量。
